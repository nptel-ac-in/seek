CountryCodesMap = {
'AF': 'Afghanistan',
'AX': 'Ã…land Islands',
'AL': 'Albania',
'DZ': 'Algeria',
'AS': 'American Samoa',
'AD': 'Andorra',
'AO': 'Angola',
'AI': 'Anguilla',
'AQ': 'Antarctica',
'AG': 'Antigua and Barbuda',
'AR': 'Argentina',
'AM': 'Armenia',
'AW': 'Aruba',
'AU': 'Australia',
'AT': 'Austria',
'AZ': 'Azerbaijan',
'BS': 'Bahamas',
'BH': 'Bahrain',
'BD': 'Bangladesh',
'BB': 'Barbados',
'BY': 'Belarus',
'BE': 'Belgium',
'BZ': 'Belize',
'BJ': 'Benin',
'BM': 'Bermuda',
'BT': 'Bhutan',
'BO': 'Bolivia',
'BA': 'Bosnia and Herzegovina',
'BW': 'Botswana',
'BV': 'Bouvet Island',
'BR': 'Brazil',
'IO': 'British Indian Ocean Territory',
'BN': 'Brunei Darussalam',
'BG': 'Bulgaria',
'BF': 'Burkina Faso',
'BI': 'Burundi',
'KH': 'Cambodia',
'CM': 'Cameroon',
'CA': 'Canada',
'CV': 'Cape Verde',
'KY': 'Cayman Islands',
'CF': 'Central African Republic',
'TD': 'Chad',
'CL': 'Chile',
'CN': 'China',
'CX': 'Christmas Island',
'CC': 'Cocos (Keeling) Islands',
'CO': 'Colombia',
'KM': 'Comoros',
'CG': 'Congo',
'CD': 'Congo, The Democratic Republic of The',
'CK': 'Cook Islands',
'CR': 'Costa Rica',
'CI': 'Cote D\'ivoire',
'HR': 'Croatia',
'CU': 'Cuba',
'CY': 'Cyprus',
'CZ': 'Czech Republic',
'DK': 'Denmark',
'DJ': 'Djibouti',
'DM': 'Dominica',
'DO': 'Dominican Republic',
'EC': 'Ecuador',
'EG': 'Egypt',
'SV': 'El Salvador',
'GQ': 'Equatorial Guinea',
'ER': 'Eritrea',
'EE': 'Estonia',
'ET': 'Ethiopia',
'FK': 'Falkland Islands (Malvinas)',
'FO': 'Faroe Islands',
'FJ': 'Fiji',
'FI': 'Finland',
'FR': 'France',
'GF': 'French Guiana',
'PF': 'French Polynesia',
'TF': 'French Southern Territories',
'GA': 'Gabon',
'GM': 'Gambia',
'GE': 'Georgia',
'DE': 'Germany',
'GH': 'Ghana',
'GI': 'Gibraltar',
'GR': 'Greece',
'GL': 'Greenland',
'GD': 'Grenada',
'GP': 'Guadeloupe',
'GU': 'Guam',
'GT': 'Guatemala',
'GG': 'Guernsey',
'GN': 'Guinea',
'GW': 'Guinea-bissau',
'GY': 'Guyana',
'HT': 'Haiti',
'HM': 'Heard Island and Mcdonald Islands',
'VA': 'Holy See (Vatican City State)',
'HN': 'Honduras',
'HK': 'Hong Kong',
'HU': 'Hungary',
'IS': 'Iceland',
'ID': 'Indonesia',
'IR': 'Iran, Islamic Republic of',
'IQ': 'Iraq',
'IE': 'Ireland',
'IM': 'Isle of Man',
'IL': 'Israel',
'IT': 'Italy',
'JM': 'Jamaica',
'JP': 'Japan',
'JE': 'Jersey',
'JO': 'Jordan',
'KZ': 'Kazakhstan',
'KE': 'Kenya',
'KI': 'Kiribati',
'KP': 'Korea, Democratic People\'s Republic of',
'KR': 'Korea, Republic of',
'KW': 'Kuwait',
'KG': 'Kyrgyzstan',
'LA': 'Lao People\'s Democratic Republic',
'LV': 'Latvia',
'LB': 'Lebanon',
'LS': 'Lesotho',
'LR': 'Liberia',
'LY': 'Libyan Arab Jamahiriya',
'LI': 'Liechtenstein',
'LT': 'Lithuania',
'LU': 'Luxembourg',
'MO': 'Macao',
'MK': 'Macedonia, The Former Yugoslav Republic of',
'MG': 'Madagascar',
'MW': 'Malawi',
'MY': 'Malaysia',
'MV': 'Maldives',
'ML': 'Mali',
'MT': 'Malta',
'MH': 'Marshall Islands',
'MQ': 'Martinique',
'MR': 'Mauritania',
'MU': 'Mauritius',
'YT': 'Mayotte',
'MX': 'Mexico',
'FM': 'Micronesia, Federated States of',
'MD': 'Moldova, Republic of',
'MC': 'Monaco',
'MN': 'Mongolia',
'ME': 'Montenegro',
'MS': 'Montserrat',
'MA': 'Morocco',
'MZ': 'Mozambique',
'MM': 'Myanmar',
'NA': 'Namibia',
'NR': 'Nauru',
'NP': 'Nepal',
'NL': 'Netherlands',
'AN': 'Netherlands Antilles',
'NC': 'New Caledonia',
'NZ': 'New Zealand',
'NI': 'Nicaragua',
'NE': 'Niger',
'NG': 'Nigeria',
'NU': 'Niue',
'NF': 'Norfolk Island',
'MP': 'Northern Mariana Islands',
'NO': 'Norway',
'OM': 'Oman',
'PK': 'Pakistan',
'PW': 'Palau',
'PS': 'Palestinian Territory, Occupied',
'PA': 'Panama',
'PG': 'Papua New Guinea',
'PY': 'Paraguay',
'PE': 'Peru',
'PH': 'Philippines',
'PN': 'Pitcairn',
'PL': 'Poland',
'PT': 'Portugal',
'PR': 'Puerto Rico',
'QA': 'Qatar',
'RE': 'Reunion',
'RO': 'Romania',
'RU': 'Russian Federation',
'RW': 'Rwanda',
'SH': 'Saint Helena',
'KN': 'Saint Kitts and Nevis',
'LC': 'Saint Lucia',
'PM': 'Saint Pierre and Miquelon',
'VC': 'Saint Vincent and The Grenadines',
'WS': 'Samoa',
'SM': 'San Marino',
'ST': 'Sao Tome and Principe',
'SA': 'Saudi Arabia',
'SN': 'Senegal',
'RS': 'Serbia',
'SC': 'Seychelles',
'SL': 'Sierra Leone',
'SG': 'Singapore',
'SK': 'Slovakia',
'SI': 'Slovenia',
'SB': 'Solomon Islands',
'SO': 'Somalia',
'ZA': 'South Africa',
'GS': 'South Georgia and The South Sandwich Islands',
'ES': 'Spain',
'LK': 'Sri Lanka',
'SD': 'Sudan',
'SR': 'Suriname',
'SJ': 'Svalbard and Jan Mayen',
'SZ': 'Swaziland',
'SE': 'Sweden',
'CH': 'Switzerland',
'SY': 'Syrian Arab Republic',
'TW': 'Taiwan, Province of China',
'TJ': 'Tajikistan',
'TZ': 'Tanzania, United Republic of',
'TH': 'Thailand',
'TL': 'Timor-leste',
'TG': 'Togo',
'TK': 'Tokelau',
'TO': 'Tonga',
'TT': 'Trinidad and Tobago',
'TN': 'Tunisia',
'TR': 'Turkey',
'TM': 'Turkmenistan',
'TC': 'Turks and Caicos Islands',
'TV': 'Tuvalu',
'UG': 'Uganda',
'UA': 'Ukraine',
'AE': 'United Arab Emirates',
'GB': 'United Kingdom',
'US': 'United States',
'UM': 'United States Minor Outlying Islands',
'UY': 'Uruguay',
'UZ': 'Uzbekistan',
'VU': 'Vanuatu',
'VE': 'Venezuela',
'VN': 'Viet Nam',
'VG': 'Virgin Islands, British',
'VI': 'Virgin Islands, U.S.',
'WF': 'Wallis and Futuna',
'EH': 'Western Sahara',
'YE': 'Yemen',
'ZM': 'Zambia',
'ZW': 'Zimbabwe' };

IndianStatesList = ['Andaman_and_Nicobar_Islands', 'Andhra_Pradesh',
'Arunachal_Pradesh', 'Assam', 'Bihar', 'Chandigarh', 'Chhattisgarh',
'Dadra_and_Nagar_Haveli', 'Delhi', 'Diu_and_Daman', 'Goa', 'Gujarat', 'Haryana',
'Himachal_Pradesh', 'Jammu_and_Kashmir', 'Jharkhand', 'Karnataka', 'Kerala',
'Lakshadweep', 'Madhya_Pradesh', 'Maharashtra', 'Manipur', 'Meghalaya',
'Mizoram', 'Nagaland', 'Odisha', 'Pondicherry', 'Punjab', 'Rajasthan', 'Sikkim',
'Tamil_Nadu', 'Telangana', 'Tripura', 'Uttarakhand', 'Uttar_Pradesh', 'West_Bengal'];

// LocalChapterDict should be defined in register.html

engineering_departments = ["Aeronautical Engineering","Agriculture Engineering","Architecture","Automobile Engineering",
"Biotechnology","Ceramic Engineering","Chemical Engineering","Civil Engineering","Computer Science and Engineering",
"Electronics and Communication Engineering","Electrical Engineering","Electronics Engineering","Environment Engineering",
"Food Engineering","Industrial Engineering","Information Technology","Instrumentation Engineering","Marine Engineering",
"Mechanical Engineering","Mechatronics Engineering","Metallurgy Engineering","Mining Engineering",
"Petrochemical Engineering","Pharmaceutical Engineering","Planning","Printing Engineering","Production Engineering",
"Textile Engineering"];

arts_humanities_departments =  ["Defense and Strategic studies","Economics","Education ","English","Geography","Hindi",
"History","History and Tourism","Home Science","Journalism","Mathematics","Modern Indian Language","Music","Philosophy",
"Political Science","Psychology","Public Administration","Punjabi","Sanskrit","Sociology"];

commerce_management_departments = ["Accounting and Finance","Banking and Insurance","Business Administration",
"Business Economics","Commerce","Company and Compensation law","Financial Markets","Labor Management",
"Tourism and Travel management"];

science_departments = ["Anthropology ","B.Sc. Medical/Life Sciences","Biochemistry","Biomedical Science","Biotechnology",
"Botany","Chemistry","Computer Science","Electronic Science","Environmental Science","Food Technology",
"Forensic Science","Information Technology","Microbiology","Operational Research","Physical Science","Physics",
"Statistics","Zoology"];

other_departments = ["B. Lib","B.Ed","B.El.Ed","BCA","Fine Arts","Foreign Languages","LLB","Multimedia and Communication",
"Performing Arts","Physical Education and Health", "Others"];

student_engineering_degrees = ["diploma","be","btech","me","mtech","ms","phd"];


function toTitleCase(str)
{
    return str.replace(/\w\S*/g, function(txt){return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();});
}

function addOptionElement(id, value, text) {
  var opt = document.createElement('option');
  opt.value = value;
  opt.text = text;
  opt.innerText = text;
  opt.setAttribute('id', id);
  return opt;
}

function fillGraduationYearOptions() {
  select_el = element('graduationyear');
  for (var i = 1950; i < 2024; ++i) {
    select_el.appendChild(addOptionElement('year_' + i, i, i));
  }
}

function fillIndianStateOptions() {
  select_el = element('state_of_residence');
  for (var i = 0; i < IndianStatesList.length; ++i) {
    state = IndianStatesList[i];
    select_el.appendChild(
      addOptionElement('state_' + state, state, state.replace(/_/g, ' ')));
  }
}

function fillCountriesOptions() {
  select_el = element('country_of_residence');
  for (var c in CountryCodesMap) {
     country_name = CountryCodesMap[c];
     select_el.appendChild(addOptionElement('country_' + c, c, country_name));
  }
}

function fillLocalChapterCollegeOptions() {
  var localChapterList = Object.keys(LocalChapterDict).map(function(key) {
    return LocalChapterDict[key];
  });
  localChapterList.sort(function(a, b) {
    if (a.name == b.name) {
      // Sort via city if names are equal
      if (a.city == b.city) {
        return 0;
      }
      return a.city < b.city ? -1 : 1;
    }
    return a.name < b.name ? -1 : 1;
  });
  select_el = element('local_chapter_college');
  for (var i in localChapterList) {
    var localChapter = localChapterList[i];
    var localChapterElementId = 'local_chapter_college_' + localChapter.college_id;
    var localChapterVisibleText = [
      localChapter.name,
      localChapter.city,
      localChapter.state
    ].join(', ');
    select_el.appendChild(addOptionElement(
      localChapterElementId, localChapter.college_id, localChapterVisibleText
    ));
  }

  select_el.appendChild(
    addOptionElement('local_chapter_college_other', 'other', 'Other'));

  //Check if value already present from jinja2
  var oldCollegeId = element('old_college_id').value;
  if (oldCollegeId) {
    select_el.value = oldCollegeId;
  }
  $("#local_chapter_college").trigger("chosen:updated");
}




function fillIndustryLocalChapterEmployerOptions() {

  var industryLocalChapterList = Object.keys(IndustryLocalChapterDict).map(function(key) {
    return IndustryLocalChapterDict[key];
  });
  industryLocalChapterList.sort(function(a, b) {
    if (a.name == b.name) {
    }
    return a.name < b.name ? -1 : 1;
  });

  var select_el = element('industry_local_chapter_employer');
  for (var i in industryLocalChapterList) {
    var localChapter = industryLocalChapterList[i];
    var localChapterElementId = 'industry_local_chapter_employer_' + localChapter.employer_id;
    var localChapterVisibleText = [
      localChapter.name
    ].join(', ');
    select_el.appendChild(addOptionElement(
      localChapterElementId, localChapter.employer_id, localChapterVisibleText
    ));
  }

  select_el.appendChild(
    addOptionElement('industry_local_chapter_employer_other', 'other', 'Other'));

  if(old_employer_id != ""){
    // var oldlocalChapterElementId = 'industry_local_chapter_employer_' + old_employer_id;
    // if(element(oldlocalChapterElementId)){
    //   element(oldlocalChapterElementId).selected = "selected";
    // }
    select_el.value = old_employer_id;
  }



}




function hideShowLocalChapter(country, profession) {
  var local_chapter_block = element('localChapterLi');
  var local_chapter_college_el = element('local_chapter_college');
  var local_chapter_el = element('local_chapter');
  if (!country) {
    country = getSelectValue(element("country_of_residence"));
  }
  if (!profession) {
    profession = getSelectValue(element("profession"));
  }
  if ("IN" == country && (profession == "student" || profession == "faculty")) {
    local_chapter_block.style.display = '';
    local_chapter_el.required = true;
    local_chapter_college_el.required = true;
  }
  else {
    local_chapter_block.style.display = 'none';
    local_chapter_el.selectedIndex = 0;
    local_chapter_el.required = false;
    local_chapter_college_el.required = false;
  }
  localChapterOnChanged();
  $("#local_chapter_college").trigger("chosen:updated");
}


function hideShowIndustryLocalChapter(country, profession) {

  var local_chapter_block = element('industryLocalChapterLi');
  var local_chapter_employer_el = element('industry_local_chapter_employer');
  var local_chapter_el = element('industry_local_chapter');
  if (!country) {
    country = getSelectValue(element("country_of_residence"));
  }
  if (!profession) {
    profession = getSelectValue(element("profession"));
  }
  if ("IN" == country && profession == "employed" ) {
    local_chapter_block.style.display = '';
    local_chapter_el.required = true;
    local_chapter_employer_el.required = true;
  }
  else {
    local_chapter_block.style.display = 'none';
    local_chapter_el.selectedIndex = 0;
    local_chapter_el.required = false;
    local_chapter_employer_el.required = false;
  }

  industryLocalChapterOnChanged();

}



function getSelectValue(selectEl) {
  if(selectEl){
    return selectEl.options[selectEl.selectedIndex].value;
  }else{
    return "";
  }
}

function countryChanged() {
  country = getSelectValue(
      element("country_of_residence"));

  var indian_state_block = element("indianStateLi");
  var non_indian_state_block = element("nonIndianStateLi");
  var local_chapter_college_el = element('local_chapter_college');
  var indian_state_select_el = element('state_of_residence');
  if ("IN" === country) {
    non_indian_state_block.style.display = 'none';
    indian_state_block.style.display = '';
    //local_chapter_college_el.style.display = '';
    indian_state_select_el.required = true;

  } else {
    indian_state_block.style.display = 'none';
    non_indian_state_block.style.display = '';
    if (country) {
      local_chapter_college_el.value = 'other';
      localChapterCollegeChanged();
      //local_chapter_college_el.style.display = 'none';
      indian_state_select_el.required = false;
    }
  }
  hideShowLocalChapter(country, null);
  //hideShowIndustryLocalChapter(country, null);
  $("#local_chapter_college").trigger("chosen:updated");
}


function create_option(id, text, selected) {
  var option = document.createElement("option");
  option.id = id;
  option.value = id;
  option.text = text;
  option.selected=selected;
  return option;
}


function update_faculty_departments(){
  faculty_area = getSelectValue(element('faculty_area'));

  //Clear everything
  faculty_department_select = element('faculty_department');
  faculty_department_select_length = faculty_department_select.options.length;
  for (var i = 0; i < faculty_department_select_length; i++) {
    console.log("remove"+i);
    faculty_department_select.remove(0);
  }

  if(faculty_department == ""){
     faculty_department_select.add(create_option("","","selected"));
  }


  if("engineering" == faculty_area){
    for(var i =0; i < engineering_departments.length; i++){
      faculty_department_select.add(create_option(engineering_departments[i],engineering_departments[i],""));
    }
  }else if("arts_humanities" == faculty_area){
    for(var i =0; i < arts_humanities_departments.length; i++){
      faculty_department_select.add(create_option(arts_humanities_departments[i],arts_humanities_departments[i],""));
    }
  }else if("commerce_management" == faculty_area){
    for(var i =0; i < commerce_management_departments.length; i++){
      faculty_department_select.add(create_option(commerce_management_departments[i],commerce_management_departments[i],""));
    }
  }else if("science" == faculty_area){
    for(var i =0; i < science_departments.length; i++){
      faculty_department_select.add(create_option(science_departments[i],science_departments[i],""));
    }
  }else if("others" == faculty_area){
    for(var i =0; i < other_departments.length; i++){
      faculty_department_select.add(create_option(other_departments[i],other_departments[i],""));
    }
  }


  if(faculty_department != "" && element(faculty_department)){
     element(faculty_department).selected = "selected";
  }


}


function update_student_departments(){
  student_degree = getSelectValue(element('student_degree'));

  //Clear everything
  student_department_select = element('student_department');
  student_department_select_length = student_department_select.options.length;
  for (var i = 0; i < student_department_select_length; i++) {
    student_department_select.remove(0);
  }

  if(student_department == ""){
     student_department_select.add(create_option("","","selected"));
  }


  if(student_engineering_degrees.includes(student_degree)){
    for(var i =0; i < engineering_departments.length; i++){
      student_department_select.add(create_option(engineering_departments[i],engineering_departments[i],""));
    }
    if ("diploma"==student_degree) {
      student_department_select.add(create_option("others","Others",""));
    }
  }else if("arts_humanities" == student_degree){
    for(var i =0; i < arts_humanities_departments.length; i++){
      student_department_select.add(create_option(arts_humanities_departments[i],arts_humanities_departments[i],""));
    }
  }else if("commerce_management" == student_degree){
    for(var i =0; i < commerce_management_departments.length; i++){
      student_department_select.add(create_option(commerce_management_departments[i],commerce_management_departments[i],""));
    }
  }else if("science" == student_degree){
    for(var i =0; i < science_departments.length; i++){
      student_department_select.add(create_option(science_departments[i],science_departments[i],""));
    }
  }else if("others" == student_degree){
    for(var i =0; i < other_departments.length; i++){
      student_department_select.add(create_option(other_departments[i],other_departments[i],""));
    }
  }


  if(student_department != "" && element(student_department)){
     element(student_department).selected = "selected";
  }


}




function professionChanged() {
  profession = getSelectValue(element("profession"));


  for_employed_only = element("for_employed_only");
  for_student_and_faculty_only = element("for_student_and_faculty_only");
  for_student_only = element("for_student_only");
  for_faculty_only = element("for_faculty_only");


  var indian_state_select_el = element('state_of_residence');
  var cityEl = element('city_of_residence');


  //hide everything first and then show required as per profession
  for_student_and_faculty_only.style.display = 'none';
  for_student_only.style.display = 'none';
  for_faculty_only.style.display = 'none';
  for_employed_only.style.display = 'none';
  //remove required settings on fields and we can add layter
  //*
  element('faculty_area_required').style.display = 'none';
  element('faculty_department_required').style.display = 'none';
  element('college_roll_no_required').style.display = 'none';
  element('student_degree_required').style.display = 'none';
  element('student_department_required').style.display = 'none';
  element('student_study_year_required').style.display = 'none';

  element('faculty_area').required = false;
  element('faculty_department').required = false;
  element('college_roll_no').required = false;
  element('college').required = false;
  element('student_degree').required = false;
  element('student_department').required = false;
  element('study_year').required = false;






  if ("employed" == profession) {
    for_employed_only.style.display = '';
    if(indian_state_select_el) {
        indian_state_select_el.required = false;
    }
    if(cityEl){
      cityEl.required = false;
    }
  }else if ("faculty"  == profession){
    for_student_and_faculty_only.style.display = '';
    for_faculty_only.style.display = '';

    element('faculty_area_required').style.display = '';
    element('faculty_department_required').style.display = '';
    element('faculty_area').required = true;
    element('faculty_department').required = true;

    faculty_department_select = element("faculty_department");


  }else if ("student" == profession){
    for_student_and_faculty_only.style.display = '';
    for_student_only.style.display ='';

    element('college_roll_no_required').style.display = '';
    element('student_degree_required').style.display = '';
    element('student_department_required').style.display = '';
    element('student_study_year_required').style.display = '';
    element('college_roll_no').required = true;
    element('student_degree').required = true;
    element('student_department').required = true;
    element('study_year').required = true;
  }
  else if ("other" == profession){
    if(indian_state_select_el) {
        indian_state_select_el.required = false;
    }
  }


  //setup the motivation
  motivation_select = element("motivation");
  var option_length = motivation_select.options.length;
  console.log("length="+option_length);
  for (var i = 0; i < option_length; i++) {
    motivation_select.remove(0);
  }

  if(motivation == ""){
     motivation_select.add(create_option("","","selected"));
  }

  if (profession == "faculty"){
     motivation_select.add(create_option("faculty_mandated_college","Mandated by college",""));
     motivation_select.add(create_option("faculty_gate_prep","For GATE exam",""));
     motivation_select.add(create_option("faculty_research","For research purposes",""));
     motivation_select.add(create_option("faculty_mentor","To mentor students in the course",""));
     motivation_select.add(create_option("faculty_prof_advance_college","Professional advancement in college",""));
     motivation_select.add(create_option("faculty_intro_new_course","To learn a new course and introduce in college",""));
     motivation_select.add(create_option("faculty_expertise","Already teach it, but to get more expertise and an idea of the course structuring",""));
     motivation_select.add(create_option("faculty_stay_updated","To update myself with current advances in science",""));

  }else if (profession == "employed"){
      motivation_select.add(create_option("professional_update_tech","Want to update myself about this technology",""));
      motivation_select.add(create_option("professional_useful_currentjob","Useful in current job",""));
      motivation_select.add(create_option("professional_change_job","Want to update and change projects/jobs",""));
      motivation_select.add(create_option("professional_recomended_company","Recommended by company",""));
      motivation_select.add(create_option("professional_stay_updated","To update myself with current advances in science",""));
  }else if (profession == "student"){
    //student or others
    motivation_select.add(create_option("student_mandated_college","Mandated by college",""));
    motivation_select.add(create_option("student_credit_transfer","Credit transfer",""));
    motivation_select.add(create_option("student_internship_job","For getting better internship/job",""));
    motivation_select.add(create_option("student_gate_prep","For GATE exam",""));
    motivation_select.add(create_option("student_research","For research purposes",""));
    motivation_select.add(create_option("student_stay_updated","To update myself with current advances in science",""));
  }else{
    motivation_select.add(create_option("others_explore_mooc","Explore online learning",""));
    motivation_select.add(create_option("others_research","For research purposes",""));
    motivation_select.add(create_option("others_update_tech","Want to update myself about this technology",""));
    motivation_select.add(create_option("others_internship_job","For getting better internship/job",""));
  }

  if(motivation != "" && element(motivation)){
     element(motivation).selected = "selected";
  }

  hideShowLocalChapter(null, profession);
  hideShowIndustryLocalChapter(null, profession);
}

function prefillSelect(old_id, select_id, id_prefix) {
  old_value =  element(old_id).value;
  if ('' != old_value) {
    if(element(id_prefix + old_value.replace(RegExp(' ', 'g'), '_'))){
      select_opt = element(id_prefix + old_value.replace(RegExp(' ', 'g'), '_')).index;
      element(select_id).selectedIndex = select_opt;
    }
  }
}

function IndianStateOnChanged() {
  var state = getSelectValue(element('state_of_residence'));
  state = state.toUpperCase().trim().replace(RegExp(' ', 'g'), '_');
  $.each($('#local_chapter_college').children(), function(idx, el) {
    if (el.value) {
      if (el.value == 'other') {
        el.style.display = '';
        return;
      }
      var lc_college_id = el.value;
      var lc_college_state = LocalChapterDict[lc_college_id].state;
      lc_college_state = lc_college_state.toUpperCase().trim().replace(RegExp(' ', 'g'), '_');
      if (lc_college_state === state || state === 'ALL') {
        el.style.display = '';
      }
      else {
        el.style.display = 'none';
      }
    }
  });
  var current_local_chapter_college_id = getSelectValue(element('local_chapter_college'));
  if (current_local_chapter_college_id && current_local_chapter_college_id !== "other") {
    var current_lc_state = LocalChapterDict[current_local_chapter_college_id].state;
    current_lc_state = current_lc_state.toUpperCase().trim().replace(RegExp(' ', 'g'), '_');
    if (current_lc_state != state) {
      element('local_chapter_college').selectedIndex = 0;
    }
  }
  $("#local_chapter_college").trigger("chosen:updated");
}


function industryLocalChapterOnChanged() {

  var industryLocalChapter = getSelectValue(element('industry_local_chapter'));
  var lcEmployer = element('industry_local_chapter_employer');
  var lcEmployerOtherOption = element('industry_local_chapter_employer_other');
  var country = getSelectValue(element('country_of_residence'));
  var profession = getSelectValue(element('profession'));
  var txtEmployer = element('employer_name');
  var txtCollege = element('college');

  txtCollege.required = false;

  if (country !== 'IN' || profession !== 'employed') {
    industryLocalChapter = false;
  }
  if (industryLocalChapter === 'true' || industryLocalChapter === true) {
    lcEmployerOtherOption.disabled = true;
    //txtEmployer.value = '';
    txtEmployer.style.display = 'none';
    txtEmployer.required = false;


    if (getSelectValue(lcEmployer) == 'other') {
      lcEmployer.value = '';
      localChapterEmployerChanged();
    }
  }else{
    if(lcEmployerOtherOption){
      lcEmployerOtherOption.disabled = false;
    }
  }
}







function localChapterOnChanged() {
  var localChapter = getSelectValue(element('local_chapter'));
  var lcCollege = element('local_chapter_college');
  var lcCollegeOtherOption = element('local_chapter_college_other');
  var country = getSelectValue(element('country_of_residence'));
  var profession = getSelectValue(element('profession'));
  var txtCollege = element('college');
  var cityBlockEl = element('cityLi');
  var rollNoInput = element('college_roll_no');
  var rollNoRequiredEl = element('college_roll_no_required');
  if (country !== 'IN' || (profession !== 'student' && profession != 'faculty')) {
    localChapter = false;
  }
  if (localChapter === 'true' || localChapter === true) {
    lcCollegeOtherOption.disabled = true;
    txtCollege.value = '';
    txtCollege.style.display = 'none';
    cityBlockEl.value = "";
    cityBlockEl.style.display = 'none';
    if(profession !== 'faculty') rollNoInput.required = true;
    rollNoRequiredEl.style.display = '';
    if (getSelectValue(lcCollege) == 'other') {
      lcCollege.value = '';
      localChapterCollegeChanged();
    }
  }
  else {
    rollNoInput.required = false;
    lcCollegeOtherOption.disabled = false;
    rollNoRequiredEl.style.display = 'none';
  }
  $("#local_chapter_college").trigger("chosen:updated");
}

function localChapterCollegeChanged() {
  var localChapterValue = element('local_chapter_college').value;
  var cityEl = element('city_of_residence');
  var cityBlockEl = element('cityLi');
  var collegeEl = element('college');
  var collegeIdEl = element('college_id');
  var profession = getSelectValue(element('profession'));
  if (!localChapterValue) {
    cityEl.value = "";
    collegeEl.value = "";
    collegeIdEl.value = "";
    return;
  }
  if (localChapterValue === 'other') {
    cityBlockEl.style.display = '';
    collegeEl.style.display = '';
    collegeIdEl.value = '';

    // Make fields required once again
    if (profession === 'student' || profession == 'faculty')
      {
        cityEl.required = true;
        collegeEl.required = true;
      }

    return;
  } else {
    cityBlockEl.style.display = 'none';
    collegeEl.style.display = 'none';
    collegeEl.required = false;
  }
  var collegeId = localChapterValue;

  // Remove required of redundant fields
  cityEl.required = false;
  collegeEl.required = false;

  collegeIdEl.value = collegeId;

  // Disable the null entry
  localChapterNullEntry = element('local_chapter_college_');
  localChapterNullEntry.disabled = true;
  $("#local_chapter_college").trigger("chosen:updated");
}


function localChapterEmployerChanged() {

  var employerEl = element('employer_name');
  var employerIdEl = element('employer_id');


  var localChapterValue = element('industry_local_chapter_employer').value;

  if (!localChapterValue) {
    employerEl.value = "";
    employerIdEl.value = "";
    return;
  }
  if (localChapterValue === 'other') {

    employerEl.style.display = '';
    employerIdEl.value = '';

    // Make fields required once again
    employerEl.required = true;

    return;
  } else {
    employerEl.style.display = 'none';
  }
  var emplyerId = localChapterValue;

  // Remove required of redundant fields
  employerEl.required = false;

  employerIdEl.value = emplyerId;

  // Disable the null entry
  industryLocalChapterNullEntry = element('industry_local_chapter_employer_');
  industryLocalChapterNullEntry.disabled = true;
}



function MakeReadOnlyIfRequired() {
  //function to make the entire form read only and disable inputs
  // Checks a hidden input make_reg_form_read_only which is populated using jinja2.

  makeReadOnly = element('make_reg_form_read_only').value;
  if (makeReadOnly) {
    // Remove agree terms, honor code, and submit button
    $('#termsLi, #honor_codeLi, #regFormSubmitLi').css('display', 'none');
    // Make everything else disabled
    $('#registrationFields :input, select').prop('disabled', true);
    // Beautify the form
    $('input:disabled, select:disabled')
    .css('color', 'black')
    .css('background-color', 'white')
    .css('border', '1px solid')
    .css('border-color', 'grey');

    // Make headings smaller
    $('#registrationFields h2').css('display', 'none');
  }
}

function initRegisterForm() {
  fillCountriesOptions();
  fillIndianStateOptions();
  fillLocalChapterCollegeOptions();
  fillGraduationYearOptions();
  prefillSelect('old_country_of_residence', 'country_of_residence', 'country_');
  countryChanged();
  old_value =  element('old_country_of_residence').value;
  if ('IN' == old_value) {
    prefillSelect('old_state_of_residence', 'state_of_residence', 'state_');
  }
  prefillSelect('old_graduation_year', 'graduationyear', 'year_');
  prefillSelect('old_age_group', 'age_group', 'age_group_');
  // yearOfGraduationChanged();
  prefillSelect('old_profession', 'profession', 'profession_');
  professionChanged();
  prefillSelect('old_local_chapter', 'local_chapter', 'local_chapter_');
  hideShowLocalChapter(null, null);
  localChapterCollegeChanged();
  IndianStateOnChanged();
  MakeReadOnlyIfRequired();



  fillIndustryLocalChapterEmployerOptions();
  prefillSelect('old_industry_local_chapter', 'industry_local_chapter', 'industry_local_chapter_');

  var employerEl = element('employer_name');
  //if employer name present and employer_id is null then its other
  if(employerEl && employerEl.value != "" && old_employer_id == ""){
      element('industry_local_chapter_employer').value = "other";
  }

  update_student_departments();
  if(faculty_department != ""){
    if(engineering_departments.includes(faculty_department)){
      faculty_area = "engineering";
    }else if(arts_humanities_departments.includes(faculty_department)){
      faculty_area = "arts_humanities";
    }else if(commerce_management_departments.includes(faculty_department)){
      faculty_area = "commerce_management";
    }else if(science_departments.includes(faculty_department)){
      faculty_area = "science";
    }else if(other_departments.includes(faculty_department)){
      faculty_area = "others";
    }

    if(element('faculty_area_'+faculty_area)){
      element('faculty_area_'+faculty_area).selected = "selected";
    }
  }

  update_faculty_departments();
  hideShowIndustryLocalChapter(null,null);
  localChapterEmployerChanged();
}

function validateForm() {
  // TODO(rthakker) Remove these validations after confirming that the 'required'
  // field works on old browsers.
  var name = element('form01').value;
  if (name == null || name.trim() == '') {
     alert('Please fill your name');
     return false;
  }

  var country_of_residence = getSelectValue(
      element('country_of_residence'));
  if (country_of_residence == null || country_of_residence == '') {
     alert('Please select your country of residence.');
     return false;
  }

  var mobile_number = element('mobile_number').value;
  var parsedNumber = libphonenumber.parse(mobile_number, country_of_residence)
  if (!libphonenumber.isValidNumber(parsedNumber)) {
    if (!confirm('Your phone number does not seem to be valid. Do you still wish to proceed?')) {
      return false;
    }
  }
  element('mobile_number').value = parsedNumber.phone;

  profession = getSelectValue(element('profession'));

  if ('IN' == country_of_residence && ( profession == 'student' || profession == 'faculty')) {
    var state_of_residence = getSelectValue(
      element('state_of_residence'));
    if (state_of_residence == null || state_of_residence == '') {
      alert('Please select your state of residence.');
      return false;
    }

    var city_of_residence_el = element('city_of_residence');
    var city_of_residence = city_of_residence_el.value;
    if (city_of_residence_el.required) {
      if (city_of_residence == null || city_of_residence.trim() == '') {
         alert('Please fill your city of residence.');
         return false;
      }
    }

    var college_el = element('college');
    var college = element('college').value;
    if (college_el.required) {
      if (college == null || college.trim() == '') {
         alert('Please fill name of your college.');
         return false;
      }
    }
  }


  var graduationyear = getSelectValue(
      element('graduationyear'));
  if (graduationyear == null || graduationyear == '') {
     alert('Please select your year of graduation.');
     return false;
  }

  var age_group = getSelectValue(
      element('age_group'));
  if (age_group == null || age_group == '') {
     alert('Please select your age group.');
     return false;
  }


  var termsInput = element('terms');
  if (null == termsInput || !termsInput.checked) {
     alert('Please accept Terms of Service');
     return false;
  }

  var honorInput = element('honor_code');
  if (null == honorInput || !honorInput.checked) {
     alert('Please accept Honor Code');
     return false;
  }
  return true;
}
